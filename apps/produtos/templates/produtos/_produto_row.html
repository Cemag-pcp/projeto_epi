{% load l10n %}
<tr id="produto-row-{{ produto.pk }}">
  <td>
    {% if produto.ca %}
      <span class="me-1 text-success" title="CA informado" aria-label="CA informado">
        <i class="bi bi-check-circle-fill"></i>
      </span>
      {{ produto.ca }}
    {% else %}
      <span class="me-1 text-danger" title="Sem CA" aria-label="Sem CA">
        <i class="bi bi-x-circle-fill"></i>
      </span>
      <span class="text-muted">-</span>
    {% endif %}
  </td>
  <td>{{ produto.data_vencimento_ca|date:"d/m/Y"|default:"-" }}</td>
  <td>
    {% if not produto.ca %}
      <span class="badge bg-danger-subtle text-danger">Sem CA</span>
    {% elif not produto.data_vencimento_ca %}
      <span class="badge bg-warning-subtle text-warning">Sem validade</span>
    {% elif produto.data_vencimento_ca < today %}
      <span class="badge bg-danger-subtle text-danger">Vencido</span>
    {% else %}
      <span class="badge bg-success-subtle text-success">Valido</span>
    {% endif %}
  </td>
  <td>{{ produto.codigo|default:"-" }}</td>
  <td>{{ produto.nome }}</td>
  <td>{{ produto.referencia|default:"-" }}</td>
  <td>{{ produto.estoque_ideal|default:"-" }}</td>
  <td>{{ produto.periodicidade_label|default:"-" }}</td>
  <td>{{ produto.unidade|default:"-" }}</td>
  <td>{{ produto.valor_medio|floatformat:2|default:"-" }}</td>
  <td class="js-produto-ativo">
    <span class="badge {% if produto.ativo %}bg-success-subtle text-success{% else %}bg-secondary-subtle text-secondary{% endif %}">
      {{ produto.ativo|yesno:"Ativo,Inativo" }}
    </span>
  </td>
  <td class="text-end">
    {% if perms.produtos.change_produto %}
      <button
        class="btn btn-outline-primary btn-icon"
        type="button"
        data-bs-toggle="modal"
        data-bs-target="#editModal-{{ produto.pk }}"
        title="Editar"
        aria-label="Editar"
      >
        <i class="bi bi-pencil"></i>
      </button>
    {% endif %}
    <button
      class="btn btn-outline-secondary btn-icon"
      type="button"
      data-bs-toggle="modal"
      data-bs-target="#viewModal-{{ produto.pk }}"
      title="Visualizar"
      aria-label="Visualizar"
    >
      <i class="bi bi-eye"></i>
    </button>
    <button
      class="btn btn-outline-info btn-icon js-produto-historico-trigger"
      type="button"
      data-bs-toggle="modal"
      data-bs-target="#produtoHistoricoModal"
      data-produto-id="{{ produto.pk }}"
      data-produto-nome="{{ produto.nome|escapejs }}"
      title="Historico"
      aria-label="Historico"
    >
      <i class="bi bi-clock-history"></i>
    </button>
    {% if perms.produtos.change_produto %}
      <form
        class="d-inline js-produto-toggle"
        id="produto-toggle-{{ produto.pk }}"
        method="post"
        action="{% url 'produtos:toggle_active' produto.pk %}"
      >
        {% csrf_token %}
      </form>
      <button
        class="btn {% if produto.ativo %}btn-outline-danger{% else %}btn-outline-success{% endif %} btn-icon js-produto-toggle-trigger"
        type="button"
        data-bs-toggle="modal"
        data-bs-target="#produtoToggleModal"
        data-form-id="produto-toggle-{{ produto.pk }}"
        data-nome="{{ produto.nome|escapejs }}"
        data-ativo="{{ produto.ativo|yesno:'1,0' }}"
        title="{% if produto.ativo %}Desativar{% else %}Ativar{% endif %}"
        aria-label="{% if produto.ativo %}Desativar{% else %}Ativar{% endif %}"
      >
        {% if produto.ativo %}
          <i class="bi bi-person-x"></i>
        {% else %}
          <i class="bi bi-person-check"></i>
        {% endif %}
      </button>
    {% endif %}
  </td>
</tr>
