{% extends "layout/base.html" %}

{% block title %}Dashboard{% endblock %}

{% block content %}
  <div class="d-flex flex-wrap align-items-center justify-content-between gap-3 mb-4">
    <div>
      <h1 class="h3 mb-1">Dashboard EPI</h1>
      <p class="text-muted mb-0">Visao geral de estoque, entregas e conformidade.</p>
    </div>
    <div class="d-flex flex-wrap gap-2">
      <button class="btn btn-outline-primary btn-sm">
        <i class="bi bi-box-seam"></i>
        Entrada de estoque
      </button>
      <button class="btn btn-primary btn-sm">
        <i class="bi bi-plus-circle"></i>
        Nova entrega
      </button>
    </div>
  </div>

  <!-- <div class="clarus-hero mb-4">
    <div class="d-flex flex-column flex-lg-row align-items-start align-items-lg-center justify-content-between gap-4">
      <div>
        <span class="clarus-pill mb-3">
          <i class="bi bi-shield-check"></i>
          Conformidade em tempo real
        </span>
        <h2 class="h3 mb-2">Seu controle completo de EPI em um so lugar.</h2>
        <p class="mb-0 text-white-50">Acompanhe entregas, treinamentos e vencimentos para manter sua operacao sempre segura.</p>
      </div>
      <div class="d-flex flex-wrap gap-2">
        <button class="btn btn-light btn-sm">
          <i class="bi bi-clipboard-data"></i>
          Ver relatorios
        </button>
        <button class="btn btn-outline-light btn-sm">
          <i class="bi bi-journal-bookmark"></i>
          Treinamentos
        </button>
      </div>
    </div>
  </div> -->

  <div class="row g-3 mb-4">
    <div class="col-12 col-md-6 col-xl-3">
      <div class="clarus-kpi h-100">
        <div class="d-flex align-items-center justify-content-between mb-2">
          <div class="text-muted small">Entregas hoje</div>
          <i class="bi bi-truck text-danger"></i>
        </div>
        <div class="value">{{ entregas_hoje }}</div>
        <div class="text-muted small">{{ entregas_delta_label }}</div>
      </div>
    </div>
    <div class="col-12 col-md-6 col-xl-3">
      <div class="clarus-kpi h-100">
        <div class="d-flex align-items-center justify-content-between mb-2">
          <div class="text-muted small">Entregas pendentes</div>
          <i class="bi bi-hourglass-split text-danger"></i>
        </div>
        <div class="value">{{ entregas_pendentes }}</div>
        <div class="text-muted small">Aguardando entrega</div>
      </div>
    </div>
    <div class="col-12 col-md-6 col-xl-3">
      <div class="clarus-kpi h-100">
        <div class="d-flex align-items-center justify-content-between mb-2">
          <div class="text-muted small">EPIs vencendo</div>
          <i class="bi bi-exclamation-triangle text-danger"></i>
        </div>
        <div class="value">{{ epis_vencendo }}</div>
        <div class="text-muted small">Proximos 30 dias</div>
      </div>
    </div>
    <div class="col-12 col-md-6 col-xl-3">
      <div class="clarus-kpi h-100">
        <div class="d-flex align-items-center justify-content-between mb-2">
          <div class="text-muted small">Treinamentos pendentes</div>
          <i class="bi bi-mortarboard text-danger"></i>
        </div>
        <div class="value">{{ treinamentos_pendentes }}</div>
        <div class="text-muted small">Necessarios por funcao</div>
      </div>
    </div>
    <div class="col-12 col-md-6 col-xl-3">
      <div class="clarus-kpi h-100">
        <div class="d-flex align-items-center justify-content-between mb-2">
          <div class="text-muted small">Estoque critico</div>
          <i class="bi bi-box2-heart text-danger"></i>
        </div>
        <div class="value">{{ estoque_critico }}</div>
        <div class="text-muted small">Itens abaixo do minimo</div>
      </div>
    </div>
  </div>

  <div class="row g-3 mb-4">
    <div class="col-12 col-lg-7">
      <div class="clarus-table-card">
        <div class="card-header d-flex align-items-center justify-content-between">
          <div>
            <div class="clarus-section-title mb-0">Operacoes do dia</div>
            <div class="text-muted small">Ultimas entregas registradas</div>
          </div>
          <button class="btn btn-outline-primary btn-sm">Ver tudo</button>
        </div>
        <div class="table-responsive">
          <table class="table align-middle">
            <thead>
              <tr>
                <th>Colaborador</th>
                <th>EPI</th>
                <th>Quantidade</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody>
              {% for item in operacoes %}
                <tr>
                  <td>{{ item.funcionario }}</td>
                  <td>{{ item.produto }}</td>
                  <td>{{ item.quantidade }}</td>
                  <td><span class="badge {{ item.status_class }}">{{ item.status_label }}</span></td>
                </tr>
              {% empty %}
                <tr>
                  <td colspan="4" class="text-muted text-center py-3">Nenhuma entrega registrada.</td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
    <div class="col-12 col-lg-5">
      <div class="card h-100">
        <div class="card-header">
          <div class="clarus-section-title mb-0">Alertas de conformidade</div>
          <div class="text-muted small">Priorize as acoes criticas</div>
        </div>
        <div class="card-body d-flex flex-column gap-3">
          {% for alert in alerts %}
            <div class="d-flex align-items-start justify-content-between gap-3">
              <div>
                <div class="fw-semibold">{{ alert.title }}</div>
                <div class="text-muted small">{{ alert.subtitle }}</div>
              </div>
              <span class="badge {{ alert.class }}">{{ alert.label }}</span>
            </div>
          {% endfor %}
          <div class="mt-auto">
            <button class="btn btn-outline-primary btn-sm w-100">Resolver pendencias</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="row g-3">
    <div class="col-12 col-lg-6">
      <div class="card h-100">
        <div class="card-header">
          <div class="clarus-section-title mb-0">Agenda de treinamentos</div>
          <div class="text-muted small">Proximas turmas e recertificacoes</div>
        </div>
        <div class="card-body">
          <div class="clarus-timeline">
            {% for item in agenda_items %}
              <div class="item">
                <div class="fw-semibold">{{ item.treinamento }}</div>
                <div class="text-muted small">
                  {{ item.data_label }} - {{ item.local }} - {{ item.inscritos }} inscritos
                </div>
              </div>
            {% empty %}
              <div class="text-muted">Nenhuma turma em aberto.</div>
            {% endfor %}
          </div>
          <button class="btn btn-outline-primary btn-sm w-100 mt-3">Gerenciar turmas</button>
        </div>
      </div>
    </div>
    <div class="col-12 col-lg-6">
      <div class="card h-100">
        <div class="card-header">
          <div class="clarus-section-title mb-0">Estoque critico por planta</div>
          <div class="text-muted small">Itens abaixo do minimo definido</div>
        </div>
        <div class="card-body d-flex flex-column gap-3">
          {% for item in estoque_cards %}
            <div>
              <div class="d-flex align-items-center justify-content-between">
                <div class="fw-semibold">{{ item.produto }} - {{ item.planta }}</div>
                <span class="text-{{ item.tone }} fw-semibold">{{ item.percent }}%</span>
              </div>
              <div class="progress" role="progressbar" aria-valuenow="{{ item.percent }}" aria-valuemin="0" aria-valuemax="100">
                <div class="progress-bar bg-{{ item.tone }}" style="width: {{ item.percent }}%"></div>
              </div>
            </div>
          {% empty %}
            <div class="text-muted">Sem itens em estoque critico.</div>
          {% endfor %}
          <div class="mt-auto">
            <button class="btn btn-outline-primary btn-sm w-100">Repor estoque</button>
          </div>
        </div>
      </div>
    </div>
  </div>
{% endblock %}
