{% extends "layout/base.html" %}

{% block title %}Presenca da turma{% endblock %}

{% block content %}
  <div class="d-flex flex-wrap align-items-center justify-content-between gap-3 mb-4">
    <div>
      <h1 class="h4 mb-1">Presenca da turma</h1>
      <p class="text-muted mb-0">{{ turma.treinamento }}</p>
    </div>
    <div class="d-flex gap-2">
      <a class="btn btn-outline-secondary btn-sm" href="{% url 'treinamentos:turmas_list' %}">Voltar</a>
      <a class="btn btn-outline-primary btn-sm" href="{% url 'treinamentos:turmas_avaliacao' turma.pk %}">Avaliacao</a>
    </div>
  </div>

  {% if aulas %}
    <div class="mb-3">
      <div class="text-muted small">Datas das aulas:</div>
      <div class="d-flex flex-wrap gap-2">
        {% for aula in aulas %}
          <span class="badge bg-light text-dark">{{ aula.data|date:"d/m/Y" }}</span>
        {% endfor %}
      </div>
    </div>
  {% endif %}

  <form method="post">
    {% csrf_token %}
    {% if turma.finalizada %}
      <div class="alert alert-info">Turma finalizada. Presenca somente para consulta.</div>
    {% endif %}
    <div class="table-responsive">
      <table class="table table-hover align-middle">
        <thead class="table-light">
          <tr>
            <th>Funcionario</th>
            {% for aula in aulas %}
              <th class="text-center">{{ aula.data|date:"d/m" }}</th>
            {% endfor %}
            <th class="text-center">Presenca</th>
          </tr>
        </thead>
        <tbody>
          {% for item in participacoes %}
            <tr>
              <td>
                {{ item.participacao.funcionario }}
                <input type="hidden" name="participante_id" value="{{ item.participacao.funcionario.id }}">
              </td>
              {% for presenca in item.presencas %}
                <td class="text-center">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    name="presenca_{{ item.participacao.funcionario.id }}_{{ presenca.aula.id }}"
                    value="1"
                    {% if presenca.presente %}checked{% endif %}
                    {% if turma.finalizada %}disabled{% endif %}
                  >
                </td>
              {% endfor %}
              <td class="text-center">
                {{ item.participacao.aulas_presentes }} / {{ turma.qtd_aulas }}
              </td>
            </tr>
          {% empty %}
            <tr>
              <td colspan="{{ aulas|length|add:2 }}" class="text-muted text-center py-4">Nenhum participante encontrado.</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% if not turma.finalizada %}
      <div class="d-flex justify-content-end mt-3">
        <button class="btn btn-primary" type="submit">Salvar</button>
      </div>
    {% endif %}
  </form>
{% endblock %}
